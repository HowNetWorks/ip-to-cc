machine:
  services:
    - docker

deployment:
  gcloud:
    tag: /^v[0-9]+\.[0-9]+\.[0-9]+$/
    commands:
      - docker build --rm=false -t ${DOCKER_HUB_IMAGE}:latest -t ${DOCKER_HUB_IMAGE}:${CIRCLE_TAG} .
      - docker login -e ${DOCKER_HUB_EMAIL} -u ${DOCKER_HUB_USER} -p ${DOCKER_HUB_PASS}
      - docker push ${DOCKER_HUB_IMAGE}:${CIRCLE_TAG}
      - docker push ${DOCKER_HUB_IMAGE}:latest
